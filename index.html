
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CurlCal â€¢ Workout Tracker + Calendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#0b1220" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M1 10h3V7h2v10H4v-3H1zm19 7h-2V7h2v3h3v4h-3zM8 17H6V7h2zm8 0h-2V7h2zM9 15V9h6v6z'/%3E%3C/svg%3E" />
  <link rel="manifest" href="manifest.json" />
  <link href="css/style.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header class="app-header">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="#000" role="img" aria-label="CurlCal">
            <path d="M1 10h3V7h2v10H4v-3H1zm19 7h-2V7h2v3h3v4h-3zM8 17H6V7h2zm8 0h-2V7h2zM9 15V9h6v6z"/>
          </svg>
        </div>
        <!-- <div class="title">CurlCal</div> -->
      </div>
      <div id="authSection">
        <button id="loginBtn" class="btn">Login with Google</button>
      </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Sections">
      <button class="tab-btn active" id="tab-library" role="tab" aria-controls="panel-library" aria-selected="true">Exercise Library</button>
      <button class="tab-btn" id="tab-workout" role="tab" aria-controls="panel-workout" aria-selected="false">Workout</button>
      <button class="tab-btn" id="tab-calendar" role="tab" aria-controls="panel-calendar" aria-selected="false">Calendar</button>
    </nav>

    <!-- Exercise Library -->
    <section class="panel active" id="panel-library" role="tabpanel" aria-labelledby="tab-library">
      <div class="filters">
        <div class="filter-chips">
          <div id="muscleChips" class="chips">
            <span class="chip active" data-muscle="All">All</span>
            <span class="chip" data-muscle="Chest">Chest</span>
            <span class="chip" data-muscle="Back">Back</span>
            <span class="chip" data-muscle="Legs">Legs</span>
            <span class="chip" data-muscle="Shoulders">Shoulders</span>
            <span class="chip" data-muscle="Arms">Arms</span>
            <span class="chip" data-muscle="Core">Core</span>
            <span class="chip" data-muscle="Full Body">Full Body</span>
            <span class="chip" data-muscle="Custom">Custom</span>
          </div>
        </div>
        <label class="search" title="Search workouts">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="#94a3b8" aria-hidden="true"><path d="M21 20l-5.7-5.7a7 7 0 10-1.4 1.4L20 21l1-1zM5 10a5 5 0 1110 0 5 5 0 01-10 0z"/></svg>
          <input id="searchInput" type="search" placeholder="Search workouts..." aria-label="Search workouts" />
        </label>
      </div>
      <div id="libraryGrid" class="grid" aria-live="polite"></div>
    </section>

    <!-- Workout -->
    <section class="panel" id="panel-workout" role="tabpanel" aria-labelledby="tab-workout">
      <div id="workoutContent">
        <div class="workout-empty">
          <div>
            <div style="font-weight:700; margin-bottom:8px">No active workout</div>
            <div class="muted" style="margin-bottom:12px">Start a plan from the Exercise Library to begin tracking sets, weights and reps.</div>
            <button class="btn" id="gotoLibraryBtn">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 7l-1.41 1.41L14.17 11H4v2h10.17l-2.58 2.59L13 17l5-5z"/></svg>
              <span class="btn-text">Go to Library</span>
            </button>
          </div>
        </div>
      </div>
      <div class="sticky-actions" id="workoutActions" style="display:none">
        <button class="btn secondary" id="breakBtn" title="Start break timer">
          <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/><path d="M10 2h4"/><path d="M6 4h2"/><path d="M16 4h2"/></svg>
          <span class="btn-text">Break</span>
        </button>
        <div id="workoutTimer" class="muted">00:00</div>
        <button class="btn secondary" id="discardWorkoutBtn" title="Discard current workout">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19a2 2 0 002 2h8a2 2 0 002-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
          <span class="btn-text">Discard</span>
        </button>
        <button class="btn success" id="finishWorkoutBtn">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.2l-3.5-3.5-1.4 1.4L9 19 20.3 7.7l-1.4-1.4z"/></svg>
          <span class="btn-text">Finish</span>
        </button>
      </div>
    </section>

    <!-- Calendar -->
    <section class="panel" id="panel-calendar" role="tabpanel" aria-labelledby="tab-calendar">
      <div class="calendar-head">
        <div style="display:flex; align-items:center; gap:8px">
          <button class="icon-btn" id="prevMonthBtn" aria-label="Previous month" title="Previous month">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="#cbd5e1"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </button>
          <div id="monthLabel" style="font-weight:700; letter-spacing:.3px">Month YYYY</div>
          <button class="icon-btn" id="nextMonthBtn" aria-label="Next month" title="Next month">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="#cbd5e1"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
          </button>
        </div>
        <div style="display:flex; gap:8px">
          <button class="btn secondary" id="todayBtn">
            <span class="btn-text">Today</span>
          </button>
        </div>
      </div>
      <div class="calendar-grid" id="dowRow" aria-hidden="true" style="margin-top:10px">
        <div class="dow">Sun</div><div class="dow">Mon</div><div class="dow">Tue</div><div class="dow">Wed</div><div class="dow">Thu</div><div class="dow">Fri</div><div class="dow">Sat</div>
      </div>
      <div class="calendar-grid" id="calendarGrid" aria-live="polite"></div>

      <div class="details" id="dayDetails" hidden>
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
          <div id="detailsTitle" style="font-weight:700; letter-spacing:.3px">Date</div>
          <div id="detailsSummary" class="muted">0 workouts</div>
        </div>
        <div id="detailsList"></div>
      </div>

      <!-- Workout Detail Modal (shows full breakdown when a saved workout is clicked in calendar) -->
      <div id="workoutDetailModal" class="modal" style="display:none">
        <div class="modal-content" role="dialog" aria-labelledby="workoutDetailTitle" style="max-width:800px">

          <div id="workoutDetailBody" style="margin-top:16px; display:flex; flex-direction:column; gap:16px; max-height:calc(80vh - 120px); overflow-y:auto; overflow-x:hidden; -webkit-overflow-scrolling:touch; scroll-behavior:smooth">

            <!-- Workout Summary Section -->
            <div class="workout-summary-section">
              <h3 id="workoutDetailTitle" style="margin:0 0 16px 0; color:var(--text); font-size:20px; font-weight:700; letter-spacing:-0.3px">Workout Overview</h3>
              <h4 style="margin:0 0 12px 0; color:var(--text); font-size:16px; font-weight:700">Workout Summary</h4>
              <div class="summary-grid">
                <div class="summary-item">
                  <div class="summary-label">Date & Time</div>
                  <div class="summary-value" id="workoutDateTime">-</div>
                </div>
                <div class="summary-item">
                  <div class="summary-label">Duration</div>
                  <div class="summary-value" id="workoutDuration">-</div>
                </div>
                <div class="summary-item">
                  <div class="summary-label">Total Exercises</div>
                  <div class="summary-value" id="workoutExerciseCount">-</div>
                </div>
                <div class="summary-item">
                  <div class="summary-label">Calories Burned</div>
                  <div class="summary-value" id="workoutCalories">-</div>
                </div>
                <div class="summary-item">
                  <div class="summary-label">Total Sets</div>
                  <div class="summary-value" id="workoutTotalSets">-</div>
                </div>
                <div class="summary-item">
                  <div class="summary-label">Completed Sets</div>
                  <div class="summary-value" id="workoutCompletedSets">-</div>
                </div>
              </div>
            </div>

            <!-- AI Summary Section (if available) -->
            <div class="ai-summary-section" id="aiSummarySection" style="display:none">
              <h4 style="margin:0 0 12px 0; color:var(--text); font-size:16px; font-weight:700; display:flex; align-items:center; gap:8px">
                <img src="img/brain.svg" alt="AI" style="width: 18px; height: 18px; filter: brightness(0) saturate(100%) invert(64%) sepia(90%) saturate(1350%) hue-rotate(160deg) brightness(95%) contrast(95%);">
                AI Analysis
              </h4>
              <div class="ai-summary-content" id="aiSummaryContent"></div>
            </div>

            <!-- Exercise Breakdown Section -->
            <div class="exercise-breakdown-section">
              <h4 style="margin:0 0 12px 0; color:var(--text); font-size:16px; font-weight:700">Exercise Breakdown</h4>
              <div class="exercise-list" id="workoutExerciseList"></div>
            </div>

          </div>

          <div class="modal-footer">
            <button id="shareWorkoutBtn" class="btn">Share Workout</button>
            <button id="closeWorkoutDetailFooterBtn" class="btn secondary">Close</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="userModal" class="modal" style="display:none">
    <div class="modal-content">
      <h3 style="margin:0 0 12px 0; font-size:16px">User Options</h3>
      <div id="apiKeyMessage" style="display:none; color: var(--warning); font-size:12px; margin-bottom:8px">
        Please set your Gemini API key. Get one from <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--accent)">Google AI Studio</a>.
      </div>
      <div style="margin-bottom:12px">
        <label for="apiKeyInput" style="display:block; margin-bottom:4px; font-size:13px">Gemini API Key:</label>
        <input type="password" id="apiKeyInput" class="input-field" placeholder="Enter your API key" style="font-size:13px">
      </div>
      <div style="margin-bottom:12px">
        <label for="breakDurationSelect" style="display:block; margin-bottom:4px; font-size:13px">Break Duration (sec):</label>
        <select id="breakDurationSelect" class="input-field" style="font-size:13px">
          <option value="30">30</option>
          <option value="60">60</option>
          <option value="90" selected>90</option>
          <option value="120">120</option>
          <option value="180">180</option>
        </select>
      </div>
      <div style="margin-bottom:12px; display:flex; gap:8px">
        <div style="flex:1">
          <label for="weightInput" style="display:block; margin-bottom:4px; font-size:13px">Weight (kg):</label>
          <input type="number" id="weightInput" class="input-field" placeholder="70" min="30" max="300" step="0.5" style="font-size:13px">
        </div>
        <div style="flex:1">
          <label for="heightInput" style="display:block; margin-bottom:4px; font-size:13px">Height (ft):</label>
          <input type="number" id="heightInput" class="input-field" placeholder="5.8" min="3" max="8" step="0.1" style="font-size:13px">
        </div>
      </div>
      <div style="margin-bottom:12px; padding:8px; background:var(--panel-2); border-radius:6px; border:1px solid var(--border)">
        <div style="font-size:12px; color:var(--muted); margin-bottom:2px">Profile:</div>
        <div id="bmrDisplay" style="font-size:12px; color:var(--text-secondary); word-break:break-all">BMR: Calculating...</div>
      </div>
      <div style="margin-bottom:12px; display:flex; flex-direction:column; gap:8px">
        <label style="display:flex; align-items:center; gap:8px; cursor:pointer; font-size:13px">
          <input type="checkbox" id="autoRestTimerToggle" checked>
          <span>Auto-rest timer</span>
        </label>
        <label style="display:flex; align-items:center; gap:8px; cursor:pointer; font-size:13px">
          <input type="checkbox" id="soundEffectsToggle" checked>
          <span>Sound effects</span>
        </label>
        <label style="display:flex; align-items:center; gap:8px; cursor:pointer; font-size:13px">
          <input type="checkbox" id="inlineCalcToggle">
          <span>Weight calculator</span>
        </label>
      </div>
      <div class="modal-footer" style="margin-top:12px">
        <button id="saveApiKeyBtn" class="btn">Save Settings</button>
        <button id="logoutBtn" class="btn">Logout</button>
        <button id="backBtn" class="btn secondary">Back</button>
      </div>
    </div>
  </div>

  <div id="incompleteModal" class="modal" style="display:none">
    <div class="modal-content">
      <h3>Finish Workout?</h3>
      <p>You have incomplete sets. What would you like to do?</p>
      <div class="modal-footer">
        <button id="continueWorkoutBtn" class="btn secondary">Continue Workout</button>
        <button id="removeIncompleteBtn" class="btn">Remove Incomplete Sets & Finish</button>
      </div>
    </div>
  </div>

  <div id="generateModal" class="modal" style="display:none">
    <div class="modal-content" role="dialog" aria-labelledby="aiGenTitle">
      <h3 id="aiGenTitle" style="display:flex; align-items:center; gap:8px">
        <img src="img/brain.svg" alt="Brain icon" style="width: 20px; height: 20px; filter: brightness(0) saturate(100%) invert(64%) sepia(90%) saturate(1350%) hue-rotate(160deg) brightness(95%) contrast(95%);">
        AI Workout Generator
      </h3>
      <div>
        <label for="workoutDescription" class="sr-only">Prompt</label>
        <input id="workoutDescription" type="text" class="input-field" placeholder="e.g., 30â€‘min push workout focusing on chest + triceps, dumbbells only" />
      </div>
      <div id="promptSuggestions" style="display:flex; flex-wrap:wrap; gap:8px">
        <button class="chip" type="button" data-suggest-prompt="Full-body beginner 25 min">Full-body beginner 25 min</button>
        <button class="chip" type="button" data-suggest-prompt="Leg day strength">Leg day strength</button>
        <button class="chip" type="button" data-suggest-prompt="Upper body pull @ home">Upper body pull @ home</button>
        <button class="chip" type="button" data-suggest-prompt="Dumbbell-only hypertrophy">Dumbbell-only hypertrophy</button>
        <button class="chip" type="button" data-suggest-prompt="Push day: chest + shoulders, 6â€“10 reps">Push day: chest + shoulders, 6â€“10 reps</button>
        <button class="chip" type="button" data-suggest-prompt="Back + biceps, cables + rows, 5 sets total">Back + biceps, cables + rows, 5 sets total</button>
      </div>
      <div id="loadingContainer" style="display:none; text-align:center; margin-top:16px">
        <div class="spinner"></div>
        <div id="statusText" style="margin-top:8px; color:var(--muted)">Initializing...</div>
      </div>
      <div class="modal-footer">
        <button id="cancelGenerateBtn" class="btn secondary" type="button">Cancel</button>
        <button id="generateBtn" class="btn" type="button">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" aria-hidden="true"><path d="M8 5v14l11-7z"/></svg>
          <span class="btn-text">Generate</span>
        </button>
      </div>
    </div>
  </div>

  <div id="summaryModal" class="modal" style="display:none">
    <div class="modal-content">
      <h3>Workout Summary</h3>
      <div id="summaryContent"></div>
      <div class="modal-footer">
        <button id="closeSummaryModal" class="btn">Close</button>
      </div>
    </div>
  </div>

  <div id="exerciseSelectorModal" class="modal" style="display:none">
    <div class="modal-content" style="max-width:900px">
      <h3>Add Exercises to Workout</h3>
      <div class="filters" style="margin-bottom:16px">
        <div class="filter-chips">
          <div id="exerciseChips" class="chips">
            <span class="chip active" data-muscle="All">All</span>
            <span class="chip" data-muscle="Chest">Chest</span>
            <span class="chip" data-muscle="Back">Back</span>
            <span class="chip" data-muscle="Shoulders">Shoulders</span>
            <span class="chip" data-muscle="Arms">Arms</span>
            <span class="chip" data-muscle="Legs">Legs</span>
            <span class="chip" data-muscle="Core">Core</span>
            <span class="chip" data-muscle="Bodyweight">Bodyweight</span>
            <span class="chip" data-muscle="Cardio">Cardio</span>
            <span class="chip" data-muscle="Full Body">Full Body</span>
          </div>
        </div>
        <label class="search" title="Search exercises">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="#94a3b8" aria-hidden="true"><path d="M21 20l-5.7-5.7a7 7 0 10-1.4 1.4L20 21l1-1zM5 10a5 5 0 1110 0 5 5 0 01-10 0z"/></svg>
          <input id="exerciseSearchInput" type="search" placeholder="Search exercises..." aria-label="Search exercises" />
        </label>
      </div>
      <div id="exerciseSelectorGrid" class="grid" style="max-height:400px; overflow-y:auto; margin-bottom:16px"></div>
      <div style="margin-bottom:16px">
        <button id="toggleCustomExerciseFormBtn" class="btn secondary" style="width:100%">Create Custom Exercise</button>
      </div>
      <div class="modal-footer">
        <button id="addSelectedExercisesBtn" class="btn">Add Selected</button>
        <button id="cancelExerciseSelectorBtn" class="btn secondary">Cancel</button>
      </div>
    </div>
  </div>

  <div id="floatingResume" class="floating-resume" style="display:none">
    <button class="btn" aria-label="Resume workout">
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 3a9 9 0 100 18 9 9 0 000-18Zm-1 5.5a1 1 0 012 0v5.586l3.293-3.293a1 1 0 111.414 1.414l-5 5a.997.997 0 01-1.414 0l-5-5A1 1 0 117.707 10.8L11 14.086V8.5Z"/></svg>
      <span class="btn-text">Resume workout</span>
    </button>
  </div>

  <div id="floatingGenerate" class="floating-generate" style="display:none">
    <button class="btn" title="Generate Custom Workout" aria-label="Generate workout">
      <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
      <span class="btn-text">Generate</span>
    </button>
  </div>

  <div id="exerciseOptionsModal" class="modal" style="display:none">
    <div class="modal-content">
      <h3>Exercise Options</h3>
      <div class="modal-footer">
        <button id="previewExerciseBtn" class="btn">Preview Exercise</button>
        <button id="replaceExerciseBtn" class="btn">Replace with Similar</button>
        <button id="removeExerciseBtn" class="btn secondary">Remove from Workout</button>
        <button id="cancelExerciseOptionsBtn" class="btn secondary">Cancel</button>
      </div>
    </div>
  </div>
   <!-- Custom Exercise Modal -->
   <div id="customExerciseModal" class="modal" style="display:none">
     <div class="modal-content" role="dialog" aria-labelledby="customExerciseTitle" style="max-width:500px">
       <h3 id="customExerciseTitle" style="margin:0">Create Custom Exercise</h3>
       <div style="display:flex; flex-direction:column; gap:12px; max-height:65vh; overflow:auto; padding-right:8px">
         <div>
           <label for="customExerciseNameInput" style="display:block; margin-bottom:4px">Exercise Name:</label>
           <input type="text" id="customExerciseNameInput" class="input-field" placeholder="e.g., Dumbbell Curl">
         </div>
         <div>
           <label for="customMuscleSelector" style="display:block; margin-bottom:4px">Target Muscle Group:</label>
           <select id="customMuscleSelector" class="input-field">
             <option value="Chest">Chest</option>
             <option value="Back">Back</option>
             <option value="Shoulders">Shoulders</option>
             <option value="Arms">Arms</option>
             <option value="Legs">Legs</option>
             <option value="Core">Core</option>
             <option value="Cardio">Cardio</option>
             <option value="Full Body">Full Body</option>
           </select>
         </div>
         <div>
           <label for="customTrackingTypeSelector" style="display:block; margin-bottom:4px">Tracking Type:</label>
           <select id="customTrackingTypeSelector" class="input-field">
             <option value="weight_reps">Weight &amp; Reps</option>
             <option value="time_distance">Time &amp; Distance</option>
           </select>
         </div>
         <div>
           <label for="customDefaultSetsSelector" style="display:block; margin-bottom:4px">Default Sets:</label>
           <input type="number" id="customDefaultSetsSelector" class="input-field" value="3" min="1">
         </div>
         <div>
           <label for="customDefaultRepsSelector" style="display:block; margin-bottom:4px">Default Reps:</label>
           <input type="number" id="customDefaultRepsSelector" class="input-field" value="10" min="1">
         </div>
         <div>
           <label for="customLinkSelector" style="display:block; margin-bottom:4px">Exercise Link (optional):</label>
           <input type="url" id="customLinkSelector" class="input-field" placeholder="https://example.com">
         </div>
       </div>
       <div class="modal-footer">
         <button id="customExerciseCancelBtn" class="btn secondary">Cancel</button>
         <button id="customExerciseSaveBtn" class="btn">Create &amp; Add</button>
       </div>
     </div>
   </div>


  <div id="breakModal" class="modal" style="display:none">
    <div class="modal-content">
      <h3>Break Time</h3>
      <div id="breakCountdown" style="font-size: 48px; font-weight: 700; text-align: center; margin: 20px 0; color: var(--accent);">01:30</div>
      <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 20px;">
        <button id="breakMinus30" class="btn secondary" title="Subtract 30 seconds">-30</button>
        <button id="breakMinus10" class="btn secondary" title="Subtract 10 seconds">-10</button>
        <button id="breakEnd" class="btn danger" title="End break">End</button>
        <button id="breakPlus10" class="btn secondary" title="Add 10 seconds">+10</button>
        <button id="breakPlus30" class="btn secondary" title="Add 30 seconds">+30</button>
      </div>
      <div class="modal-footer">
        <button id="closeBreakModal" class="btn secondary" style="width: 100%;">Close</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <!-- Firebase Config -->
  <script src="js/config.js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- Google Gen AI SDK -->
  <script type="module" src="https://esm.run/@google/genai"></script>

  <script src="js/workoutData.js"></script>
  <script type="module" src="js/script.js"></script>
</body>
</html>